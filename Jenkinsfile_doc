pipeline {
    agent {
        docker {
            label "local"
            image "docker.hops.works/hopsworks_twine:0.0.2"
        }
    }
    stages {
        stage("publish") {
            steps {
                sh "python auto_doc.py"
                
                dir("docs") {
                    sh "python3 ./setup.py sdist"
                    sh "twine upload -u $PYPI_USR -p $PYPI_PSW --skip-existing dist/*"
                }
            }
        }
    }
}